<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CALIBRATION TFS TOOLS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', 'Noto Sans Thai', sans-serif; }
        :root { --schindler-red: #d52b1e; }

        body { background-color: #f8fafc; }

        /* --- Interactive Dashboard Cards --- */
        .box-3d {
            background-color: white;
            border: 1px solid #e5e7eb;
            box-shadow: 4px 4px 0px 0px rgba(0, 0, 0, 0.08); 
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        /* Active Filter State: Force White Text for Visibility */
        .card-active-all, .card-active-normal, .card-active-warning, .card-active-overdue {
            color: white !important;
            transform: translate(2px, 2px);
            box-shadow: 0px 0px 0px 0px transparent !important;
        }
        .card-active-all { background-color: #334155 !important; border-color: #1e293b !important; }
        .card-active-normal { background-color: #059669 !important; border-color: #064e3b !important; }
        .card-active-warning { background-color: #d97706 !important; border-color: #92400e !important; }
        .card-active-overdue { background-color: #d52b1e !important; border-color: #991b1b !important; }

        .card-active-all p, .card-active-all h3,
        .card-active-normal p, .card-active-normal h3,
        .card-active-warning p, .card-active-warning h3,
        .card-active-overdue p, .card-active-overdue h3 {
            color: white !important;
            opacity: 1 !important;
        }

        /* Tool Cards */
        .tool-card { border-top: 4px solid transparent; }
        .border-normal { border-top-color: #10b981; }
        .border-warning { border-top-color: #f59e0b; }
        .border-overdue { border-top-color: #d52b1e; }

        /* Custom Scrollbar for Modals */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        /* Loader */
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid white; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        @keyframes slideDown { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-down { animation: slideDown 0.3s ease-out forwards; }
    </style>
</head>
<body class="h-full text-gray-800">

    <div id="app" class="min-h-full flex flex-col max-w-7xl mx-auto">
        
        <!-- HEADER (COMPACT & RED) -->
        <header class="bg-[#d52b1e] text-white shadow-md sticky top-0 z-50 px-4 py-2.5">
            <div class="flex flex-col gap-2">
                <!-- Row 1: Title Area -->
                <div class="min-w-0">
                    <h1 class="text-sm md:text-lg font-black tracking-tighter leading-none uppercase" data-i18n="title">
                        CALIBRATION TFS TOOLS
                    </h1>
                    <p class="text-[8px] md:text-xs text-red-100 font-medium leading-none opacity-80 mt-1" data-i18n="subtitle">
                        ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ ‡πÅ‡∏ú‡∏ô‡∏ÅTFS
                    </p>
                </div>

                <!-- Row 2: Search Box + Action Buttons (All in one row) -->
                <div class="flex items-center gap-1.5 pt-1.5 border-t border-white/20">
                    <!-- Search Input -->
                    <div class="relative flex-1 max-w-[140px] sm:max-w-xs">
                        <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™..." 
                               class="w-full pl-7 pr-2 py-1.5 rounded bg-white/10 border border-white/20 text-white placeholder-white/50 text-[11px] focus:bg-white focus:text-gray-900 focus:outline-none transition-all shadow-inner" 
                               onkeyup="filterBySearch()">
                        <svg class="absolute left-2 top-2 text-white/50" width="12" height="12" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>

                    <!-- Buttons Group (Added History Button at the end) -->
                    <div class="flex items-center gap-1 ml-auto">
                        <button onclick="openHelpModal()" class="px-2 py-1.5 bg-white/10 hover:bg-white/20 rounded text-[9px] font-bold flex items-center gap-1 transition border border-white/10">
                            <span>üìò</span> <span id="manualBtnText" class="hidden xs:inline uppercase">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠</span>
                        </button>
                        <button onclick="toggleLang()" class="px-2 py-1.5 bg-white/10 hover:bg-white/20 rounded text-[9px] font-bold transition w-8 text-center border border-white/10" id="langBtn">TH</button>
                        <button onclick="toggleAdmin()" id="adminBtn" class="p-1.5 bg-white/10 hover:bg-white/20 rounded transition relative border border-white/10" title="Admin Mode">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
                            <span id="adminIndicator" class="absolute top-0 right-0 w-2 h-2 bg-green-400 rounded-full border border-[#d52b1e] hidden"></span>
                        </button>
                        <!-- Global History Button -->
                        <button onclick="openGlobalHistory()" class="p-1.5 bg-white/10 hover:bg-white/20 rounded border border-white/10" title="Full History">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>
                        </button>
                        <!-- Add Button (Visible only to Admin) -->
                        <button onclick="openAddModal()" id="addBtn" class="hidden px-2.5 py-1.5 bg-white text-[#d52b1e] font-black text-[9px] rounded shadow-sm hover:bg-red-50 transition flex items-center gap-1 uppercase">
                            <span>+</span> <span data-i18n="btn_add">ADD</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- DASHBOARD -->
        <main class="p-3 pb-20 space-y-4">
            
            <!-- Filter Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2.5">
                <div id="card-all" onclick="setFilter('all')" class="box-3d p-2.5 rounded shadow-sm card-active-all">
                    <p class="text-[9px] font-bold text-gray-400 uppercase tracking-wider" data-i18n="stat_total">TOTAL</p>
                    <h3 id="statTotal" class="text-xl font-black">0</h3>
                </div>
                <div id="card-normal" onclick="setFilter('normal')" class="box-3d p-2.5 border-l-4 border-emerald-500 rounded shadow-sm">
                    <p class="text-[9px] font-bold text-emerald-600/70 uppercase tracking-wider" data-i18n="stat_normal">NORMAL</p>
                    <h3 id="statNormal" class="text-xl font-black text-emerald-600">0</h3>
                </div>
                <div id="card-warning" onclick="setFilter('warning')" class="box-3d p-2.5 border-l-4 border-amber-500 rounded shadow-sm">
                    <p class="text-[9px] font-bold text-amber-600/70 uppercase tracking-wider" data-i18n="stat_soon">DUE SOON</p>
                    <h3 id="statWarning" class="text-xl font-black text-amber-500">0</h3>
                </div>
                <div id="card-overdue" onclick="setFilter('overdue')" class="box-3d p-2.5 border-l-4 border-red-500 rounded shadow-sm">
                    <p class="text-[9px] font-bold text-red-600/70 uppercase tracking-wider" data-i18n="stat_overdue">OVERDUE</p>
                    <h3 id="statOverdue" class="text-xl font-black text-red-600">0</h3>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="flex flex-col items-center justify-center py-20">
                <div class="loader !border-red-600 !border-t-transparent mb-3"></div>
                <p class="text-[10px] text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• TFS...</p>
            </div>

            <!-- Tool List -->
            <div id="equipmentList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 hidden"></div>
        </main>
    </div>

    <!-- MODAL: HELP / MANUAL (Redesigned) -->
    <div id="helpModalOverlay" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-lg shadow-2xl flex flex-col custom-scroll">
            <div class="p-4 flex justify-between items-center border-b sticky top-0 bg-white z-10">
                <div class="flex items-center gap-2">
                    <span class="text-xl">üìò</span>
                    <h2 class="font-black text-sm uppercase tracking-tighter" id="manualTitle">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (User Manual)</h2>
                </div>
                <button onclick="closeHelpModal()" class="text-gray-400 hover:text-black font-bold text-xl">&times;</button>
            </div>
            <div class="p-5 space-y-6 text-xs text-gray-600 leading-relaxed">
                <!-- Overview -->
                <section>
                    <h3 class="font-bold text-blue-700 border-l-4 border-blue-700 pl-2 mb-2 uppercase">1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö (System Overview)</h3>
                    <p>‡∏£‡∏∞‡∏ö‡∏ö <strong>CALIBRATION TFS TOOLS</strong> ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å TFS ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö Real-time ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</p>
                </section>

                <!-- Status Meanings -->
                <section>
                    <h3 class="font-bold text-blue-700 border-l-4 border-blue-700 pl-2 mb-2 uppercase">2. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Status Meanings)</h3>
                    <div class="grid grid-cols-1 gap-2 mt-2">
                        <div class="flex items-center gap-2 p-2 bg-emerald-50 border border-emerald-100 rounded">
                            <span class="w-3 h-3 bg-emerald-500 rounded-full shrink-0"></span>
                            <span class="font-bold text-emerald-700">‡∏õ‡∏Å‡∏ï‡∏¥ (Normal):</span> <span>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 30 ‡∏ß‡∏±‡∏ô</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-amber-50 border border-amber-100 rounded">
                            <span class="w-3 h-3 bg-amber-500 rounded-full shrink-0"></span>
                            <span class="font-bold text-amber-700">‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏£‡∏ö (Due Soon):</span> <span>‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 30 ‡∏ß‡∏±‡∏ô (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏™‡πà‡∏á‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö)</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-red-50 border border-red-100 rounded">
                            <span class="w-3 h-3 bg-red-500 rounded-full shrink-0"></span>
                            <span class="font-bold text-red-700">‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î (Overdue):</span> <span>‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÅ‡∏•‡πâ‡∏ß **‡∏´‡πâ‡∏≤‡∏°‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**</span>
                        </div>
                    </div>
                </section>

                <!-- Admin System (Detailed) -->
                <section class="bg-gray-50 p-4 rounded border border-gray-200">
                    <h3 class="font-bold text-red-700 border-l-4 border-red-700 pl-2 mb-3 uppercase">3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Admin System)</h3>
                    <p class="mb-3 font-medium">‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô):</p>
                    
                    <div class="space-y-4">
                        <div>
                            <p class="font-bold text-gray-800">üîí ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö:</p>
                            <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏π‡∏õ‡πÇ‡∏•‡πà (üõ°Ô∏è) ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</p>
                        </div>
                        <div>
                            <p class="font-bold text-gray-800">‚ûï ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Add Tool):</p>
                            <ul class="list-decimal pl-4 space-y-1 mt-1">
                                <li>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>+ ADD</strong> ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ö Header</li>
                                <li><strong>‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢:</strong> ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</li>
                                <li><strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</strong> ‡∏Å‡∏£‡∏≠‡∏Å ID, ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠, ‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å)</li>
                                <li><strong>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£:</strong> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡πÉ‡∏ö Certificate (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)</li>
                                <li>‡∏Å‡∏î <strong>SAVE</strong> ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à</li>
                            </ul>
                        </div>
                        <div>
                            <p class="font-bold text-gray-800">‚úèÔ∏è ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö (Edit & Delete):</p>
                            <ul class="list-decimal pl-4 space-y-1 mt-1">
                                <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>EDIT</strong> ‡∏™‡∏µ‡∏î‡∏≥‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</li>
                                <li>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå PDF/‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                                <li>‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>‡∏•‡∏ö (Delete)</strong> ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>
            <div class="p-4 border-t bg-gray-50 text-center">
                <button onclick="closeHelpModal()" class="px-8 py-2 bg-gray-800 text-white font-bold text-xs rounded uppercase tracking-widest shadow hover:bg-black transition-all">‡∏õ‡∏¥‡∏î‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠</button>
            </div>
        </div>
    </div>

    <!-- MODAL: LOGIN -->
    <div id="loginModal" class="fixed inset-0 bg-black/80 z-[110] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-xs p-6 rounded-lg text-center shadow-2xl border-t-8 border-[#d52b1e]">
            <div class="text-3xl mb-3">üõ°Ô∏è</div>
            <h3 class="font-black text-sm mb-4 uppercase">Admin Login</h3>
            <input type="password" id="adminPass" class="w-full border-2 border-gray-200 p-2.5 text-center rounded-lg mb-4 font-bold focus:border-[#d52b1e] outline-none" placeholder="PASSWORD">
            <div class="flex gap-2">
                <button onclick="document.getElementById('loginModal').classList.add('hidden')" class="flex-1 text-gray-400 font-bold text-[10px] uppercase">Cancel</button>
                <button onclick="checkLogin()" class="flex-1 py-2.5 bg-[#d52b1e] text-white font-bold rounded-lg text-[10px] shadow-sm">LOGIN</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GLOBAL / SINGLE HISTORY -->
    <div id="historyModal" class="fixed inset-0 bg-black/80 z-[120] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md max-h-[85vh] rounded-lg shadow-2xl flex flex-col overflow-hidden border-2 border-black">
            <div class="p-3 bg-gray-100 border-b flex justify-between items-center">
                <h3 class="font-black text-[10px] uppercase" id="historyModalTitle">Calibration History</h3>
                <button onclick="document.getElementById('historyModal').classList.add('hidden')" class="text-xl font-bold text-gray-400">&times;</button>
            </div>
            <div id="historyContent" class="p-4 overflow-y-auto flex-1 space-y-3 bg-gray-50 custom-scroll"></div>
        </div>
    </div>

    <!-- MODAL: ADD / EDIT TOOL -->
    <div id="addModalOverlay" class="fixed inset-0 bg-black/70 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md max-h-[90vh] overflow-y-auto border-2 border-black p-5 relative rounded-lg shadow-2xl custom-scroll">
            <div class="flex justify-between items-center mb-5 border-b pb-2">
                <h2 class="text-lg font-black uppercase text-gray-900" id="modalTitle" data-i18n="modal_title">ADD TOOL</h2>
                <button onclick="closeAddModal()" class="text-gray-400 hover:text-red-600 text-2xl font-bold">&times;</button>
            </div>
            
            <form id="addForm" onsubmit="submitData(event)" class="space-y-4">
                <input type="hidden" id="rowIndex"> 
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 mb-1 uppercase tracking-widest" data-i18n="label_photo">PHOTO</label>
                    <label class="block w-full h-32 bg-gray-50 border-2 border-dashed border-gray-200 hover:border-red-500 cursor-pointer relative flex items-center justify-center overflow-hidden transition-all rounded">
                        <img id="preview" class="absolute w-full h-full object-cover hidden">
                        <div id="uploadPlaceholder" class="text-center text-gray-300"><span class="text-xl">üì∑</span><p class="text-[9px] font-bold mt-1" data-i18n="tap_camera">ATTACH PHOTO</p></div>
                        <input type="file" id="imgInput" accept="image/*" class="hidden" onchange="handleImage(this)">
                    </label>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[9px] font-bold text-gray-400 block mb-1">TOOL ID *</label><input type="text" id="inp_id" required class="w-full border p-2 rounded text-xs font-bold focus:border-red-500 outline-none"></div>
                    <div><label class="text-[9px] font-bold text-gray-400 block mb-1">NAME TOOL *</label><input type="text" id="inp_name" required class="w-full border p-2 rounded text-xs font-bold focus:border-red-500 outline-none"></div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[9px] font-bold text-gray-400 block mb-1">LAST DATE</label><input type="date" id="inp_last" class="w-full border p-2 rounded text-xs focus:border-red-500 outline-none"></div>
                    <div><label class="text-[9px] font-bold text-red-400 block mb-1">NEXT DUE *</label><input type="date" id="inp_next" required class="w-full border border-red-100 p-2 rounded text-xs font-bold focus:border-red-500 outline-none"></div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[9px] font-bold text-gray-400 block mb-1">PSI *</label><input type="text" id="inp_psi" required class="w-full border p-2 rounded text-xs focus:border-red-500 outline-none"></div>
                    <div><label class="text-[9px] font-bold text-gray-400 block mb-1" data-i18n="label_remarks">REMARKS</label><input type="text" id="inp_rem" class="w-full border p-2 rounded text-xs focus:border-red-500 outline-none"></div>
                </div>
                <div>
                    <label class="text-[9px] font-bold text-gray-400 block mb-1" data-i18n="label_pdf">ATTACH CALIBRATION DOC (PDF)</label>
                    <label class="flex items-center w-full p-2 border border-gray-200 bg-gray-50 rounded cursor-pointer hover:bg-gray-100 transition-colors">
                        <span class="text-sm mr-2">üìÑ</span>
                        <span id="pdfName" class="text-[9px] text-gray-500 truncate flex-1 uppercase font-bold">Choose PDF...</span>
                        <input type="file" id="pdfInput" accept="application/pdf" class="hidden" onchange="handlePdf(this)">
                    </label>
                </div>
                <div class="pt-2 flex gap-2">
                    <button type="button" onclick="deleteItem()" id="btnDelete" class="hidden px-4 py-2 bg-red-100 text-red-600 font-bold text-[10px] rounded hover:bg-red-200 transition">‡∏•‡∏ö</button>
                    <div class="flex-1"></div>
                    <button type="button" onclick="closeAddModal()" class="px-4 py-2 text-gray-500 text-[10px] font-bold hover:underline uppercase" data-i18n="btn_cancel">CANCEL</button>
                    <button type="submit" id="submitBtn" class="px-8 py-2 bg-[#d52b1e] text-white font-black text-[10px] rounded shadow-sm hover:bg-red-700 transition uppercase" data-i18n="btn_save">SAVE</button>
                </div>
            </form>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzVKnhJyBqOn8Pk9lfITsEVa3lrMUEC-lvu76V77luxZQa_WagUZg5uaEJrgdY9kGE0/exec';
        
        let allRecordsRaw = []; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏ß‡∏°
        let allDataLatest = []; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å (‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
        let displayData = [];
        let currentFilter = 'all';
        let isAdmin = false;
        let imageBase64 = null;
        let pdfBase64 = null;
        let currentLang = 'th';

        const translations = {
            en: {
                title: "CALIBRATION TFS TOOLS", subtitle: "Management System - TFS Dept.",
                btn_add: "ADD", stat_total: "TOTAL", stat_normal: "NORMAL",
                stat_soon: "DUE SOON", stat_overdue: "OVERDUE", modal_title: "ADD TOOL", label_photo: "PHOTO",
                tap_camera: "ATTACH PHOTO", btn_cancel: "CANCEL", btn_save: "SAVE", status_over: "Overdue", 
                status_left: "Days Left", label_remarks: "REMARKS", label_pdf: "ATTACH PDF", view_pdf: "VIEW DOC"
            },
            th: {
                title: "CALIBRATION TFS TOOLS", subtitle: "‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ ‡πÅ‡∏ú‡∏ô‡∏ÅTFS",
                btn_add: "‡πÄ‡∏û‡∏¥‡πà‡∏°", stat_total: "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", stat_normal: "‡∏õ‡∏Å‡∏ï‡∏¥",
                stat_soon: "‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏£‡∏ö", stat_overdue: "‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î", modal_title: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå", label_photo: "‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢",
                tap_camera: "‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ", btn_cancel: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å", btn_save: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å", status_over: "‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î", 
                status_left: "‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å", label_remarks: "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏", label_pdf: "‡πÅ‡∏ô‡∏ö PDF", view_pdf: "‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£"
            }
        };

        window.onload = () => { fetchData(); updateUI(); };

        async function fetchData() {
            try {
                const res = await fetch(GOOGLE_SCRIPT_URL);
                const json = await res.json();
                if (json.status === 'error') throw new Error(json.message);
                
                allRecordsRaw = Array.isArray(json) ? json : [];
                
                const groups = {};
                allRecordsRaw.forEach(item => {
                    if(!groups[item.id]) groups[item.id] = [];
                    groups[item.id].push(item);
                });

                allDataLatest = Object.values(groups).map(group => {
                    group.sort((a, b) => new Date(b.nextDate) - new Date(a.nextDate));
                    const latest = group[0];
                    const diff = Math.ceil((new Date(latest.nextDate) - new Date()) / (1000 * 60 * 60 * 24));
                    latest.days = diff;
                    latest.status = diff < 0 ? 'overdue' : (diff <= 30 ? 'warning' : 'normal');
                    latest.history = group;
                    return latest;
                }).sort((a, b) => {
                    const p = { overdue: 0, warning: 1, normal: 2 };
                    return p[a.status] - p[b.status];
                });

                updateStats();
                applyFilter();
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('equipmentList').classList.remove('hidden');
            } catch (err) {
                console.error(err);
                document.getElementById('loadingState').innerHTML = `<p class='text-xs text-red-500'>Connection Failed: ${err.message}</p>`;
            }
        }

        function setFilter(type) {
            currentFilter = type;
            document.querySelectorAll('.box-3d').forEach(el => el.classList.remove('card-active-all', 'card-active-normal', 'card-active-warning', 'card-active-overdue'));
            const activeCardId = `card-${type}`;
            const activeClass = type === 'all' ? 'card-active-all' : `card-active-${type}`;
            document.getElementById(activeCardId).classList.add(activeClass);
            applyFilter();
        }

        function filterBySearch() { applyFilter(); }

        function applyFilter() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            displayData = allDataLatest.filter(item => {
                const matchesFilter = (currentFilter === 'all' || item.status === currentFilter);
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) || item.id.toLowerCase().includes(searchTerm);
                return matchesFilter && matchesSearch;
            });
            renderList(displayData);
        }

        function renderList(data) {
            const list = document.getElementById('equipmentList');
            list.innerHTML = '';
            if(data.length === 0) {
                list.innerHTML = `<div class="col-span-full py-10 text-center text-gray-300 text-[10px] font-bold uppercase tracking-widest">No Items Found</div>`;
                return;
            }
            data.forEach(item => {
                let statusColor = item.status === 'overdue' ? 'text-red-600' : (item.status === 'warning' ? 'text-amber-600' : 'text-emerald-600');
                let statusText = item.status === 'overdue' ? `‡πÄ‡∏Å‡∏¥‡∏ô ${Math.abs(item.days)} ‡∏ß‡∏±‡∏ô` : `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${item.days} ‡∏ß‡∏±‡∏ô`;
                let imgHtml = item.image ? `<img src="${item.image}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center bg-gray-50 text-gray-300 text-[10px] font-bold">NO IMAGE</div>`;
                let pdfBtn = item.pdf ? `<button onclick="window.open('${item.pdf.replace('/view', '/preview')}', '_blank')" class="text-[9px] bg-blue-50 text-blue-600 border border-blue-200 px-2 py-1 rounded flex items-center gap-1 hover:bg-blue-100 transition-colors uppercase font-black tracking-tight">üìÑ ${translations[currentLang].view_pdf}</button>` : '';
                let editBtn = isAdmin ? `<button onclick="editItem('${item.id}')" class="text-[9px] bg-gray-800 text-white px-2 py-1 rounded shadow-sm font-black tracking-tighter">EDIT</button>` : '';

                list.innerHTML += `
                    <div class="box-3d flex flex-col rounded bg-white overflow-hidden tool-card border-${item.status}">
                        <div class="h-32 w-full relative bg-white border-b border-gray-100">
                            ${imgHtml}
                            <div class="absolute top-2 right-2">
                                <span class="px-2 py-1 text-[8px] font-black uppercase rounded bg-white/95 shadow-sm border ${statusColor} border-current">${statusText}</span>
                            </div>
                        </div>
                        <div class="p-3 flex-1 flex flex-col">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-[9px] font-bold text-gray-400 tracking-widest uppercase">#${item.id}</span>
                                <button onclick="viewSingleHistory('${item.id}')" class="text-[8px] text-gray-400 hover:text-gray-900 underline font-bold uppercase">üïí History</button>
                            </div>
                            <h3 class="font-black text-gray-800 text-xs leading-tight mb-2 truncate">${item.name}</h3>
                            <div class="mt-auto pt-2 border-t border-gray-50 text-[9px]">
                                <div class="flex justify-between mb-2">
                                    <span class="text-gray-500 font-bold uppercase">PSI: ${item.owner || '-'}</span>
                                    <span class="font-black text-gray-900 font-mono">${formatDate(item.nextDate)}</span>
                                </div>
                                <div class="flex justify-between items-center">${pdfBtn}${editBtn}</div>
                            </div>
                        </div>
                    </div>`;
            });
        }

        // --- HISTORY FUNCTIONS ---
        function openGlobalHistory() {
            document.getElementById('historyModalTitle').innerText = "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏ß‡∏° (Global Logs)";
            const con = document.getElementById('historyContent');
            con.innerHTML = '';
            
            // Sort raw records by recorded date (timestamp) desc
            const sortedRecords = [...allRecordsRaw].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            sortedRecords.forEach(h => {
                con.innerHTML += createHistoryRow(h);
            });
            document.getElementById('historyModal').classList.remove('hidden');
        }

        function viewSingleHistory(id) {
            const item = allDataLatest.find(d => d.id === id);
            document.getElementById('historyModalTitle').innerText = `‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠: ${id}`;
            const con = document.getElementById('historyContent');
            con.innerHTML = '';
            item.history.forEach(h => {
                con.innerHTML += createHistoryRow(h);
            });
            document.getElementById('historyModal').classList.remove('hidden');
        }

        function createHistoryRow(h) {
            return `
                <div class="bg-white p-3 rounded border border-gray-200 text-[10px] shadow-sm">
                    <div class="flex justify-between font-black text-gray-800 uppercase">
                        <span>${formatDate(h.nextDate)}</span>
                        <span class="text-[8px] font-normal text-gray-400 italic">Saved: ${formatDate(h.timestamp)}</span>
                    </div>
                    <div class="flex justify-between mt-1 items-center">
                        <p class="text-gray-600 font-bold uppercase">ID: ${h.id} | PSI: ${h.owner || '-'}</p>
                        ${h.pdf ? `<a href="${h.pdf}" target="_blank" class="text-blue-500 underline text-[8px]">Cert.</a>` : ''}
                    </div>
                    ${h.remarks ? `<p class="italic text-gray-400 mt-1 border-t pt-1 border-gray-50">"${h.remarks}"</p>` : ''}
                </div>`;
        }

        // --- ADMIN & AUTH ---
        function toggleAdmin() {
            if (isAdmin) {
                isAdmin = false;
                document.getElementById('adminIndicator').classList.add('hidden');
                document.getElementById('addBtn').classList.add('hidden');
                renderList(displayData);
            } else {
                document.getElementById('loginModal').classList.remove('hidden');
            }
        }

        function checkLogin() {
            if (document.getElementById('adminPass').value === 'jiraphong2227') {
                isAdmin = true;
                document.getElementById('adminIndicator').classList.remove('hidden');
                document.getElementById('addBtn').classList.remove('hidden');
                document.getElementById('loginModal').classList.add('hidden');
                document.getElementById('adminPass').value = '';
                renderList(displayData);
            } else { alert("WRONG PASSWORD"); }
        }

        function openAddModal() {
            document.getElementById('modalTitle').innerText = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå";
            document.getElementById('addForm').reset();
            document.getElementById('preview').classList.add('hidden');
            document.getElementById('uploadPlaceholder').classList.remove('hidden');
            document.getElementById('pdfName').innerText = "Choose PDF...";
            document.getElementById('inp_id').readOnly = false;
            document.getElementById('btnDelete').classList.add('hidden');
            document.getElementById('rowIndex').value = "";
            imageBase64 = null; pdfBase64 = null;
            document.getElementById('addModalOverlay').classList.remove('hidden');
        }

        function editItem(id) {
            const item = allDataLatest.find(d => d.id === id);
            document.getElementById('modalTitle').innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            document.getElementById('rowIndex').value = item.rowIndex;
            document.getElementById('inp_id').value = item.id;
            document.getElementById('inp_id').readOnly = true;
            document.getElementById('inp_name').value = item.name;
            document.getElementById('inp_last').value = item.lastDate ? new Date(item.lastDate).toISOString().split('T')[0] : '';
            document.getElementById('inp_next').value = item.nextDate ? new Date(item.nextDate).toISOString().split('T')[0] : '';
            document.getElementById('inp_psi').value = item.owner || "";
            document.getElementById('inp_rem').value = item.remarks || '';
            if (item.image) { document.getElementById('preview').src = item.image; document.getElementById('preview').classList.remove('hidden'); document.getElementById('uploadPlaceholder').classList.add('hidden'); }
            document.getElementById('btnDelete').classList.remove('hidden');
            document.getElementById('addModalOverlay').classList.remove('hidden');
        }

        async function submitData(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.innerText = "UPLOADING..."; btn.disabled = true;
            const payload = {
                action: document.getElementById('rowIndex').value ? 'edit' : 'add',
                rowIndex: document.getElementById('rowIndex').value,
                id: document.getElementById('inp_id').value,
                name: document.getElementById('inp_name').value,
                lastDate: document.getElementById('inp_last').value,
                nextDate: document.getElementById('inp_next').value,
                psi: document.getElementById('inp_psi').value,
                remarks: document.getElementById('inp_rem').value,
                imageBase64: imageBase64, pdfBase64: pdfBase64,
                currentImage: document.getElementById('preview').src
            };
            try {
                const r = await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
                fetchData();
                closeAddModal();
            } catch (err) { alert(err.message); }
            finally { btn.innerText = "SAVE"; btn.disabled = false; }
        }

        async function deleteItem() {
            if(!confirm("CONFIRM DELETE TOOL?")) return;
            const rIdx = document.getElementById('rowIndex').value;
            await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'delete', rowIndex: rIdx }) });
            fetchData(); closeAddModal();
        }

        // --- UTILS ---
        function toggleLang() {
            currentLang = currentLang === 'en' ? 'th' : 'en';
            updateUI(); applyFilter();
        }
        function updateUI() {
            document.querySelectorAll('[data-i18n]').forEach(el => el.innerText = translations[currentLang][el.dataset.i18n]);
            document.getElementById('langBtn').innerText = currentLang === 'en' ? "EN" : "TH";
            document.getElementById('manualBtnText').innerText = currentLang === 'en' ? "MANUAL" : "‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠";
        }
        function updateStats() {
            document.getElementById('statTotal').innerText = allDataLatest.length;
            document.getElementById('statNormal').innerText = allDataLatest.filter(d => d.status === 'normal').length;
            document.getElementById('statWarning').innerText = allDataLatest.filter(d => d.status === 'warning').length;
            document.getElementById('statOverdue').innerText = allDataLatest.filter(d => d.status === 'overdue').length;
        }
        function closeAddModal() { document.getElementById('addModalOverlay').classList.add('hidden'); }
        function openHelpModal() { document.getElementById('helpModalOverlay').classList.remove('hidden'); }
        function closeHelpModal() { document.getElementById('helpModalOverlay').classList.add('hidden'); }
        function handleImage(i) { fileToBase64(i, (b) => { imageBase64 = b; document.getElementById('preview').src = b; document.getElementById('preview').classList.remove('hidden'); document.getElementById('uploadPlaceholder').classList.add('hidden'); }); }
        function handlePdf(i) { if(i.files[0].size > 5*1024*1024) return alert("FILE > 5MB"); document.getElementById('pdfName').innerText = i.files[0].name; fileToBase64(i, (b) => pdfBase64 = b); }
        function fileToBase64(inp, cb) { const fr = new FileReader(); fr.onload = (e) => cb(e.target.result); fr.readAsDataURL(inp.files[0]); }
        function formatDate(d) { if(!d) return "-"; const date = new Date(d); return `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()}`; }
    </script>
</body>
</html>

